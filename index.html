<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Puzzling Together T-Cell Clones from Single-Cell TCR-Seq Data • VDJigsaw</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Puzzling Together T-Cell Clones from Single-Cell TCR-Seq Data">
<meta name="description" content="A toolkit for processing single-cell TCR-sequencing data into clonotype groups with varying levels of stringency. VDJigsaw addresses the challenge of missing chain data by leveraging dataset-wide evidence to puzzle together T-cell receptor alpha and beta chains into coherent clonotype definitions, reducing fragmented clonotypes caused by sequencing dropout.">
<meta property="og:description" content="A toolkit for processing single-cell TCR-sequencing data into clonotype groups with varying levels of stringency. VDJigsaw addresses the challenge of missing chain data by leveraging dataset-wide evidence to puzzle together T-cell receptor alpha and beta chains into coherent clonotype definitions, reducing fragmented clonotypes caused by sequencing dropout.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">VDJigsaw</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/VDJigsaw_Vignette_01.html">Getting Started with VDJigsaw</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/doRemy/VDJigsaw"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="vdjigsaw--puzzling-together-t-cell-clones-from-single-cell-tcr-seq-data">VDJigsaw — Puzzling Together T-Cell Clones from Single-Cell TCR-Seq Data<a class="anchor" aria-label="anchor" href="#vdjigsaw--puzzling-together-t-cell-clones-from-single-cell-tcr-seq-data"></a>
</h1></div>
<p>VDJigsaw is a toolkit for processing single-cell TCR-sequencing data into clonotype groups with varying levels of stringency and to map them to various types of representation.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Single-cell T Cell Receptor sequencing (scTCR-seq) is a powerful approach for exploring TCR diversity and identifying clonally related T cells. TCRs are heterodimers composed of two protein chains: alpha and beta. In most cases, a T cell is expected to express only one alpha-beta pair. However, while it is unlikely that a cell expresses two distinct beta chains, it is relatively common (~30%) for a cell to express two alpha chains.</p>
<p>Clonotype assignment — grouping cells into the same clone — is a challenging problem in scTCR-seq data. What makes it particularly non-trivial is that chain information is frequently missing for individual cells due to sequencing dropout and low TCR-chain detection sensitivity.</p>
<p>As a concrete example: imagine two cells, Cell-1 and Cell-2, sharing the same TCR-beta chain. Cell-1 has one TCR-alpha chain captured (alpha-1), while Cell-2 has two (alpha-1 and alpha-2). Note that alpha-1 matches between the two cells.</p>
<p>Since Cell-1 and Cell-2 share the same beta chain and at least one alpha chain allele, the key question is whether:</p>
<ul>
<li>Cell-1 actually has a second alpha allele identical to alpha-1 (homozygous), or</li>
<li>Cell-1 is heterozygous with alpha-2 as its second allele, but alpha-2 was not captured due to dropout.</li>
</ul>
<p>Current tools conservatively default to the first assumption and require an exact match on all chains, or only consider the primary alleles of both chains.</p>
<p>However, given the immensely large diversity of TCRs generated through VDJ recombination, it is reasonable to assume that Cell-1 and Cell-2 belong to the same clonotype — it is very unlikely that two independent T-cell clones share the same beta chain and one of the same alpha alleles by chance.</p>
<p>To test this, one could examine the other TCR sequences in the sample for evidence refuting this hypothesis. If no conflicting observation exists, it is reasonable to assume that these cells belong to the same clone and that the missing chain in Cell-1 simply failed to be captured.</p>
<p>VDJigsaw addresses this by “puzzling” the different chains together into clone IDs at varying levels of stringency, allowing researchers to recover as many cells as possible into coherent clonotype definitions while controlling how permissive the matching is.</p>
<p>This approach reduces the number of fragmented clonotypes caused by missing data and offers a more data-driven method for clonotype assignment.</p>
<p>See the <a href="#method">Method</a> section below for more details.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install VDJigsaw directly from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"doRemy/VDJigsaw"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doRemy.github.io/VDJigsaw/">VDJigsaw</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Load VDJ filtered contigs</span></span>
<span><span class="va">VDJ.contigs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"filtered_contig_annotations.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Assign clonotypes</span></span>
<span><span class="va">VDJigsaw_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/assign_clonotype.html">assign_clonotype</a></span><span class="op">(</span></span>
<span>  VDJ_data <span class="op">=</span> <span class="va">VDJ.contigs</span>,</span>
<span>  sample_col <span class="op">=</span> <span class="st">"orig.ident"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Retrieve outputs</span></span>
<span><span class="va">TCR_data</span> <span class="op">&lt;-</span> <span class="va">VDJigsaw_res</span><span class="op">$</span><span class="va">TCR_data</span></span>
<span><span class="va">reference_tables</span> <span class="op">&lt;-</span> <span class="va">VDJigsaw_res</span><span class="op">$</span><span class="va">ref_tables</span></span>
<span></span>
<span><span class="co"># 4. Visualize</span></span>
<span><span class="fu"><a href="reference/plot_stringency_summary.html">plot_stringency_summary</a></span><span class="op">(</span><span class="va">TCR_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_clone_composition.html">plot_clone_composition</a></span><span class="op">(</span><span class="va">reference_tables</span><span class="op">$</span><span class="va">dual_chain_dual_allele</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_clone_composition.html">plot_clone_composition</a></span><span class="op">(</span><span class="va">reference_tables</span><span class="op">$</span><span class="va">single_chain_single_allele</span><span class="op">)</span></span></code></pre></div>
<p>For a full walkthrough with real data, see the <a href="https://doRemy.github.io/VDJigsaw/articles/VDJigsaw_Vignette_01.html">Getting Started vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p><code><a href="reference/assign_clonotype.html">assign_clonotype()</a></code> returns a list with two elements:</p>
<ul>
<li>
<strong><code>TCR_data</code></strong> — A data frame with one row per cell barcode, containing the TCR alpha/beta chains and a clone ID column for each stringency level.</li>
<li>
<strong><code>ref_tables</code></strong> — A named list of reference tables (one per stringency level), each mapping a <code>CloneID</code> to its TCR chain composition.</li>
</ul>
</div>
<div class="section level2">
<h2 id="method">Method<a class="anchor" aria-label="anchor" href="#method"></a>
</h2>
<div class="section level3">
<h3 id="input-format">Input Format<a class="anchor" aria-label="anchor" href="#input-format"></a>
</h3>
<p>After pre-processing the scTCR-seq data, VDJigsaw processes the raw VDJ contigs data into a table where each row represents a cell (identified by its barcode) and the columns are:</p>
<table class="table">
<thead><tr class="header">
<th>Column</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>TRA_1</code></td>
<td>Primary TCR alpha chain allele</td>
</tr>
<tr class="even">
<td><code>TRA_2</code></td>
<td>Secondary TCR alpha chain allele</td>
</tr>
<tr class="odd">
<td><code>TRB_1</code></td>
<td>Primary TCR beta chain allele</td>
</tr>
<tr class="even">
<td><code>TRB_2</code></td>
<td>Secondary TCR beta chain allele</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="clonotype-stringency-levels">Clonotype Stringency Levels<a class="anchor" aria-label="anchor" href="#clonotype-stringency-levels"></a>
</h3>
<p>VDJigsaw groups cells into clonotypes using a hierarchy of stringency levels. Each successive level is more permissive, incorporating all the rules from the levels above it plus additional, more relaxed matching criteria. The goal is to treat missing values as potentially compatible rather than as mismatches, and to assign as many cells as possible to coherent clonotypes.</p>
<blockquote>
<p><strong>Note:</strong> At any level of stringency, no clonotype will be defined by more than two TCR-alpha and two TCR-beta chains. This is enforced by grouping cells into a clonotype only when there are no conflicts (i.e., no two different values for the same chain position within a clonotype).</p>
</blockquote>
<p>The stringency levels are named along two axes: <strong>which chains are required</strong> (both α and β, or just one) and <strong>how many alleles per chain</strong> (both alleles, or just one).</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="12%">
<col width="33%">
<col width="39%">
</colgroup>
<thead><tr class="header">
<th>Level</th>
<th>Name</th>
<th>Chains required</th>
<th>Alleles per chain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>dual_chain_dual_allele</code></td>
<td>Both α and β</td>
<td>Both alleles (1 and 2)</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>dual_chain_one_partial</code></td>
<td>Both α and β</td>
<td>One chain can have a single allele</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>dual_chain_both_partial</code></td>
<td>Both α and β</td>
<td>Both chains can have a single allele</td>
</tr>
<tr class="even">
<td>4</td>
<td><code>single_chain_dual_allele</code></td>
<td>α or β alone</td>
<td>Both alleles (1 and 2)</td>
</tr>
<tr class="odd">
<td>5</td>
<td><code>single_chain_single_allele</code></td>
<td>α or β alone</td>
<td>A single allele suffices</td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="dual_chain_dual_allele--both-chains-both-alleles-must-match">
<code>dual_chain_dual_allele</code> — Both chains, both alleles must match<a class="anchor" aria-label="anchor" href="#dual_chain_dual_allele--both-chains-both-alleles-must-match"></a>
</h4>
<p>The strictest level. All four chain positions must be identical between cells.</p>
<ul>
<li>
<code>TRA_1</code>, <code>TRA_2</code>, <code>TRB_1</code>, and <code>TRB_2</code> must all match.</li>
</ul>
</div>
<div class="section level4">
<h4 id="dual_chain_one_partial--both-chains-required-one-chain-may-have-a-missing-allele">
<code>dual_chain_one_partial</code> — Both chains required, one chain may have a missing allele<a class="anchor" aria-label="anchor" href="#dual_chain_one_partial--both-chains-required-one-chain-may-have-a-missing-allele"></a>
</h4>
<p>Relaxes the requirement on <strong>one</strong> of the two chains: either the alpha or the beta chain can have a missing secondary allele, as long as there are no conflicts.</p>
<ul>
<li>Full match on all four chains, <strong>or</strong>
</li>
<li>
<code>TRA_1</code>, <code>TRB_1</code>, and <code>TRB_2</code> match with no conflicting <code>TRA_2</code> values (covers cases where <code>TRA_2</code> is missing), <strong>or</strong>
</li>
<li>
<code>TRA_1</code>, <code>TRA_2</code>, and <code>TRB_1</code> match with no conflicting <code>TRB_2</code> values (covers cases where <code>TRB_2</code> is missing).</li>
</ul>
</div>
<div class="section level4">
<h4 id="dual_chain_both_partial--both-chains-required-both-may-have-a-missing-allele">
<code>dual_chain_both_partial</code> — Both chains required, both may have a missing allele<a class="anchor" aria-label="anchor" href="#dual_chain_both_partial--both-chains-required-both-may-have-a-missing-allele"></a>
</h4>
<p>Relaxes the requirement on <strong>both</strong> chains: the secondary allele can be missing on both the alpha and beta chain simultaneously.</p>
<ul>
<li>All rules from <code>dual_chain_one_partial</code>, <strong>or</strong>
</li>
<li>
<code>TRA_1</code> and <code>TRB_1</code> match with no conflicts on secondary chains.</li>
</ul>
</div>
<div class="section level4">
<h4 id="single_chain_dual_allele--only-one-chain-required-but-both-alleles-must-match">
<code>single_chain_dual_allele</code> — Only one chain required, but both alleles must match<a class="anchor" aria-label="anchor" href="#single_chain_dual_allele--only-one-chain-required-but-both-alleles-must-match"></a>
</h4>
<p>No longer requires both receptor chains. A clonotype can be defined by a single chain type (alpha or beta), as long as both alleles of that chain match.</p>
<ul>
<li>All rules from <code>dual_chain_both_partial</code>, <strong>or</strong>
</li>
<li>
<code>TRA_1</code> and <code>TRA_2</code> match with no conflicts on beta chains, <strong>or</strong>
</li>
<li>
<code>TRB_1</code> and <code>TRB_2</code> match with no conflicts on alpha chains.</li>
</ul>
</div>
<div class="section level4">
<h4 id="single_chain_single_allele--the-most-permissive-level">
<code>single_chain_single_allele</code> — The most permissive level<a class="anchor" aria-label="anchor" href="#single_chain_single_allele--the-most-permissive-level"></a>
</h4>
<p>A clonotype can be defined by a single allele of a single chain. This maximizes cell recovery but should be used with caution.</p>
<ul>
<li>All rules from <code>single_chain_dual_allele</code>, <strong>or</strong>
</li>
<li>
<code>TRA_1</code> alone matches with no conflicts on other chains, <strong>or</strong>
</li>
<li>
<code>TRB_1</code> alone matches with no conflicts on other chains.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="graph-based-clonotype-assignment-algorithm">Graph-Based Clonotype Assignment Algorithm<a class="anchor" aria-label="anchor" href="#graph-based-clonotype-assignment-algorithm"></a>
</h3>
<p>Clonotype assignment is performed <strong>independently per sample</strong> and proceeds through the stringency levels <strong>from strictest to most permissive</strong>. At each level, VDJigsaw:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Generates clone version strings</strong> — For each cell, the relevant chain values (as defined by the current stringency level) are concatenated into a composite identifier. For example, at the strictest level, this is <code>Sample_TRA1_TRA2_TRB1_TRB2</code>; at more permissive levels, some chain positions are omitted.</p></li>
<li><p><strong>Builds a pairwise similarity matrix</strong> — Each cell’s full clone version string is compared against all other cells’ clone version strings for the current level. Two cells are considered compatible if any of their clone version strings match. Matches from stricter levels are carried forward, so compatibility is cumulative.</p></li>
<li><p><strong>Constructs a graph</strong> — The similarity matrix is used as an adjacency matrix to build an undirected graph (via <a href="https://r.igraph.org/" class="external-link">igraph</a>), where nodes are cells and edges connect compatible cells.</p></li>
<li><p><strong>Identifies connected components</strong> — Each connected component in the graph defines a candidate clonotype. Cells with no edges (no match at any level) remain unassigned.</p></li>
<li><p><strong>Resolves conflicts</strong> — A connected component is checked for conflicts: if it contains more than two distinct alleles for any chain position (e.g., three different TRA_1 values), the component is invalid. In this case, VDJigsaw falls back to the clustering from the previous (stricter) stringency level for the affected cells, ensuring that no clonotype is defined by more than two alpha and two beta chain alleles.</p></li>
</ol>
<p>This hierarchical approach means that cells first assigned at a strict level retain that assignment, and each successive level only adds new assignments for cells that were previously unmatched — while always enforcing the two-allele-per-chain constraint.</p>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>The main limitation of this approach is <strong>doublets</strong>. When two cells are captured in the same droplet, their TCR chains get mixed, potentially joining unrelated chains into a single clonotype. We recommend running VDJigsaw after quality control and doublet removal on your scRNA-seq data.</p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If you use VDJigsaw in your research, please cite this repository:</p>
<blockquote>
<p>Pétremand, R. VDJigsaw: Puzzling Together T-Cell Clones from Single-Cell TCR-Seq Data. <a href="https://github.com/doRemy/VDJigsaw" class="external-link uri">https://github.com/doRemy/VDJigsaw</a></p>
</blockquote>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>This project is licensed under the <a href="LICENSE">GPL-3.0 License</a>.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>VDJigsaw is not currently accepting external contributions. This may change in the future — stay tuned.</p>
</div>
<div class="section level2">
<h2 id="transparency-note">Transparency Note<a class="anchor" aria-label="anchor" href="#transparency-note"></a>
</h2>
<p>AI (Claude, Anthropic) was used to assist with documentation writing and unit testing. All scientific content, methodology, and core implementation are the work of the author.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/doRemy/VDJigsaw/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/doRemy/VDJigsaw/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing VDJigsaw</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Rémy Pétremand <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rémy Pétremand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
